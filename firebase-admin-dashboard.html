<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Admin Dashboard - Maa Anpurna Aahar</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f5f5;
      color: #333;
    }
    
    .dashboard {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .header {
      background: #2c3e50;
      color: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .stat-card h3 {
      color: #ff9800;
      font-size: 2rem;
      margin-bottom: 10px;
    }
    
    .stat-card p {
      color: #666;
      font-size: 1.1rem;
    }
    
    .data-section {
      background: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .data-section h2 {
      color: #2c3e50;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #ff9800;
    }
    
    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    
    .data-table th,
    .data-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    
    .data-table th {
      background: #f8f9fa;
      font-weight: 600;
      color: #2c3e50;
    }
    
    .data-table tr:hover {
      background: #f8f9fa;
    }
    
    .status-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    .status-new {
      background: #e3f2fd;
      color: #1976d2;
    }
    
    .status-verified {
      background: #e8f5e8;
      color: #2e7d32;
    }
    
    .status-active {
      background: #fff3e0;
      color: #f57c00;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }
    
    .error {
      background: #ffebee;
      color: #c62828;
      padding: 15px;
      border-radius: 5px;
      margin: 15px 0;
    }
    
    .success {
      background: #e8f5e8;
      color: #2e7d32;
      padding: 15px;
      border-radius: 5px;
      margin: 15px 0;
    }
    
    .refresh-btn {
      background: #ff9800;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      margin-bottom: 20px;
    }
    
    .refresh-btn:hover {
      background: #f57c00;
    }
    
    @media (max-width: 768px) {
      .dashboard {
        padding: 10px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .data-table {
        font-size: 0.9rem;
      }
      
      .data-table th,
      .data-table td {
        padding: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="header">
      <h1>ðŸŒ¾ Firebase Admin Dashboard</h1>
      <p>Maa Anpurna Aahar - User & Data Management</p>
    </div>
    
    <div id="connectionStatus"></div>
    
    <div class="stats-grid">
      <div class="stat-card">
        <h3 id="totalUsers">-</h3>
        <p>Total Users</p>
      </div>
      <div class="stat-card">
        <h3 id="totalMessages">-</h3>
        <p>Contact Messages</p>
      </div>
      <div class="stat-card">
        <h3 id="todayRegistrations">-</h3>
        <p>Today's Registrations</p>
      </div>
      <div class="stat-card">
        <h3 id="activeUsers">-</h3>
        <p>Active Users</p>
      </div>
    </div>
    
    <div class="data-section">
      <h2>Recent Users</h2>
      <button class="refresh-btn" onclick="loadUsers()">Refresh Data</button>
      <div id="usersLoading" class="loading">Loading users...</div>
      <div id="usersError" class="error" style="display: none;"></div>
      <table class="data-table" id="usersTable" style="display: none;">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Registration Date</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="usersTableBody"></tbody>
      </table>
    </div>
    
    <div class="data-section">
      <h2>Contact Messages</h2>
      <button class="refresh-btn" onclick="loadMessages()">Refresh Messages</button>
      <div id="messagesLoading" class="loading">Loading messages...</div>
      <div id="messagesError" class="error" style="display: none;"></div>
      <table class="data-table" id="messagesTable" style="display: none;">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Subject</th>
            <th>Message</th>
            <th>Date</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="messagesTableBody"></tbody>
      </table>
    </div>
  </div>
  
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  
  <!-- Your Firebase Configuration -->
  <script src="firebase-config.js"></script>
  
  <script>
    let firebaseInitialized = false;
    
    // Initialize Firebase when page loads
    document.addEventListener('DOMContentLoaded', async function() {
      try {
        // You need to replace this with your actual Firebase config
        const firebaseConfig = {
          apiKey: "your-api-key",
          authDomain: "your-project.firebaseapp.com",
          projectId: "your-project-id",
          storageBucket: "your-project.appspot.com",
          messagingSenderId: "123456789",
          appId: "your-app-id"
        };
        
        const result = await window.firebaseManager.initialize(firebaseConfig);
        
        if (result.success) {
          firebaseInitialized = true;
          showStatus('Connected to Firebase successfully!', 'success');
          loadDashboardData();
        } else {
          showStatus('Failed to connect to Firebase: ' + result.message, 'error');
        }
      } catch (error) {
        console.error('Dashboard initialization error:', error);
        showStatus('Dashboard initialization failed: ' + error.message, 'error');
      }
    });
    
    function showStatus(message, type) {
      const statusDiv = document.getElementById('connectionStatus');
      statusDiv.className = type;
      statusDiv.textContent = message;
      statusDiv.style.display = 'block';
      
      if (type === 'success') {
        setTimeout(() => {
          statusDiv.style.display = 'none';
        }, 3000);
      }
    }
    
    async function loadDashboardData() {
      if (!firebaseInitialized) {
        showStatus('Firebase not initialized', 'error');
        return;
      }
      
      await Promise.all([
        loadUsers(),
        loadMessages(),
        loadStats()
      ]);
    }
    
    async function loadUsers() {
      const loadingDiv = document.getElementById('usersLoading');
      const errorDiv = document.getElementById('usersError');
      const table = document.getElementById('usersTable');
      
      loadingDiv.style.display = 'block';
      errorDiv.style.display = 'none';
      table.style.display = 'none';
      
      try {
        if (!window.firebaseManager.db) {
          throw new Error('Firestore not initialized');
        }
        
        // Get users from Firestore
        const snapshot = await window.firebaseManager.db.collection('users')
          .orderBy('registrationDate', 'desc')
          .limit(20)
          .get();
        
        const tbody = document.getElementById('usersTableBody');
        tbody.innerHTML = '';
        
        if (snapshot.empty) {
          tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: #666;">No users found</td></tr>';
        } else {
          snapshot.forEach(doc => {
            const user = doc.data();
            const row = document.createElement('tr');
            
            const regDate = user.registrationDate ? 
              (user.registrationDate.toDate ? user.registrationDate.toDate() : new Date(user.registrationDate)) :
              new Date();
            
            row.innerHTML = `
              <td>${user.firstName || ''} ${user.lastName || ''}</td>
              <td>${user.email || '-'}</td>
              <td>${user.phone || '-'}</td>
              <td>${regDate.toLocaleDateString()}</td>
              <td><span class="status-badge status-verified">Verified</span></td>
            `;
            
            tbody.appendChild(row);
          });
        }
        
        loadingDiv.style.display = 'none';
        table.style.display = 'table';
      } catch (error) {
        console.error('Load users error:', error);
        loadingDiv.style.display = 'none';
        errorDiv.textContent = 'Error loading users: ' + error.message;
        errorDiv.style.display = 'block';
      }
    }
    
    async function loadMessages() {
      const loadingDiv = document.getElementById('messagesLoading');
      const errorDiv = document.getElementById('messagesError');
      const table = document.getElementById('messagesTable');
      
      loadingDiv.style.display = 'block';
      errorDiv.style.display = 'none';
      table.style.display = 'none';
      
      try {
        if (!window.firebaseManager.db) {
          throw new Error('Firestore not initialized');
        }
        
        // Get messages from Firestore
        const snapshot = await window.firebaseManager.db.collection('contactMessages')
          .orderBy('timestamp', 'desc')
          .limit(20)
          .get();
        
        const tbody = document.getElementById('messagesTableBody');
        tbody.innerHTML = '';
        
        if (snapshot.empty) {
          tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #666;">No messages found</td></tr>';
        } else {
          snapshot.forEach(doc => {
            const message = doc.data();
            const row = document.createElement('tr');
            
            const msgDate = message.timestamp ? 
              (message.timestamp.toDate ? message.timestamp.toDate() : new Date(message.timestamp)) :
              new Date();
            
            row.innerHTML = `
              <td>${message.name || '-'}</td>
              <td>${message.email || '-'}</td>
              <td>${message.subject || '-'}</td>
              <td>${(message.message || '').substring(0, 50)}${message.message && message.message.length > 50 ? '...' : ''}</td>
              <td>${msgDate.toLocaleDateString()}</td>
              <td><span class="status-badge status-new">${message.status || 'new'}</span></td>
            `;
            
            tbody.appendChild(row);
          });
        }
        
        loadingDiv.style.display = 'none';
        table.style.display = 'table';
      } catch (error) {
        console.error('Load messages error:', error);
        loadingDiv.style.display = 'none';
        errorDiv.textContent = 'Error loading messages: ' + error.message;
        errorDiv.style.display = 'block';
      }
    }
    
    async function loadStats() {
      try {
        if (!window.firebaseManager.db) {
          return;
        }
        
        // Get user count
        const usersSnapshot = await window.firebaseManager.db.collection('users').get();
        document.getElementById('totalUsers').textContent = usersSnapshot.size;
        
        // Get message count
        const messagesSnapshot = await window.firebaseManager.db.collection('contactMessages').get();
        document.getElementById('totalMessages').textContent = messagesSnapshot.size;
        
        // Get today's registrations
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        const todaySnapshot = await window.firebaseManager.db.collection('users')
          .where('registrationDate', '>=', today)
          .get();
        document.getElementById('todayRegistrations').textContent = todaySnapshot.size;
        
        // Get active users (logged in last 7 days)
        const weekAgo = new Date();
        weekAgo.setDate(weekAgo.getDate() - 7);
        
        const activeSnapshot = await window.firebaseManager.db.collection('users')
          .where('lastLoginDate', '>=', weekAgo)
          .get();
        document.getElementById('activeUsers').textContent = activeSnapshot.size;
        
      } catch (error) {
        console.error('Load stats error:', error);
        // Set default values on error
        document.getElementById('totalUsers').textContent = '0';
        document.getElementById('totalMessages').textContent = '0';
        document.getElementById('todayRegistrations').textContent = '0';
        document.getElementById('activeUsers').textContent = '0';
      }
    }
  </script>
</body>
</html>