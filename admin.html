<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Maa Anpurna Aahar</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      background: #f8f9fa;
    }
    
    .header {
      background: linear-gradient(135deg, #2c3e50, #34495e);
      color: white;
      padding: 20px 0;
      text-align: center;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
    }
    
    .admin-nav {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    
    .nav-btn {
      padding: 10px 20px;
      background: #ff9800;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
      font-weight: 500;
      transition: background 0.3s;
    }
    
    .nav-btn:hover {
      background: #f57c00;
    }
    
    .nav-btn.active {
      background: #2c3e50;
    }
    
    .admin-section {
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .section-title {
      font-size: 1.5rem;
      color: #2c3e50;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #ff9800;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: linear-gradient(135deg, #ff9800, #f57c00);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }
    
    .stat-number {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .stat-label {
      font-size: 0.9rem;
      opacity: 0.9;
    }
    
    .search-box {
      margin-bottom: 20px;
    }
    
    .search-box input {
      width: 100%;
      max-width: 400px;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 1rem;
    }
    
    .users-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    .users-table th,
    .users-table td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e9ecef;
    }
    
    .users-table th {
      background: #f8f9fa;
      font-weight: 600;
      color: #2c3e50;
    }
    
    .users-table tr:hover {
      background: #f8f9fa;
    }
    
    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #ff9800;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      margin-right: 10px;
    }
    
    .user-info {
      display: flex;
      align-items: center;
    }
    
    .status-badge {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    .status-online {
      background: #d4edda;
      color: #155724;
    }
    
    .status-offline {
      background: #f8d7da;
      color: #721c24;
    }
    
    .action-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.8rem;
      margin-right: 5px;
      transition: all 0.3s;
    }
    
    .btn-view {
      background: #007bff;
      color: white;
    }
    
    .btn-delete {
      background: #dc3545;
      color: white;
    }
    
    .btn-view:hover {
      background: #0056b3;
    }
    
    .btn-delete:hover {
      background: #c82333;
    }
    
    .export-section {
      text-align: center;
      margin-top: 30px;
    }
    
    .hidden {
      display: none;
    }
    
    .user-details {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }
    
    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #e9ecef;
    }
    
    .detail-row:last-child {
      border-bottom: none;
    }
    
    .detail-label {
      font-weight: 600;
      color: #495057;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .users-table {
        font-size: 0.9rem;
      }
      
      .users-table th,
      .users-table td {
        padding: 8px;
      }
      
      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }
      
      .admin-nav {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üõ†Ô∏è Admin Panel - Maa Anpurna Aahar</h1>
    <p>User Management & Analytics</p>
  </div>

  <div class="container">
    <nav class="admin-nav">
      <a href="index.html" class="nav-btn">‚Üê Back to Website</a>
      <button class="nav-btn active" onclick="showSection('users')">Users</button>
      <button class="nav-btn" onclick="showSection('analytics')">Analytics</button>
      <button class="nav-btn" onclick="showSection('settings')">Settings</button>
      <button class="nav-btn" onclick="refreshData()">üîÑ Refresh</button>
      <button class="nav-btn" onclick="exportData()">üìä Export Data</button>
    </nav>

    <!-- Users Section -->
    <div id="usersSection" class="admin-section">
      <h2 class="section-title">Registered Users</h2>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" id="totalUsers">0</div>
          <div class="stat-label">Total Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="onlineUsers">0</div>
          <div class="stat-label">Online Users</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="newUsersToday">0</div>
          <div class="stat-label">New Today</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalOrders">0</div>
          <div class="stat-label">Total Orders</div>
        </div>
      </div>

      <div class="search-box">
        <input type="text" id="userSearch" placeholder="Search users by name or email..." onkeyup="filterUsers()">
      </div>

      <table class="users-table" id="usersTable">
        <thead>
          <tr>
            <th>User</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Registered</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="usersTableBody">
          <!-- Users will be populated by JavaScript -->
        </tbody>
      </table>
    </div>

    <!-- Analytics Section -->
    <div id="analyticsSection" class="admin-section hidden">
      <h2 class="section-title">Analytics & Insights</h2>
      
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" id="avgOrderValue">‚Çπ0</div>
          <div class="stat-label">Avg Order Value</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="conversionRate">0%</div>
          <div class="stat-label">Conversion Rate</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="cartItems">0</div>
          <div class="stat-label">Items in Carts</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="topProduct">-</div>
          <div class="stat-label">Top Product</div>
        </div>
      </div>

      <div class="user-details">
        <h3>Registration Timeline</h3>
        <div id="registrationChart">
          <!-- Chart would go here in a real application -->
          <p>Registration data will be displayed here...</p>
        </div>
      </div>
    </div>

    <!-- Settings Section -->
    <div id="settingsSection" class="admin-section hidden">
      <h2 class="section-title">System Settings</h2>
      
      <div class="user-details">
        <h3>Data Management</h3>
        <button class="nav-btn" onclick="clearAllData()" style="background: #dc3545; margin: 10px 5px;">Clear All User Data</button>
        <button class="nav-btn" onclick="createSampleData()" style="background: #28a745; margin: 10px 5px;">Create Sample Data</button>
        <button class="nav-btn" onclick="backupData()" style="background: #17a2b8; margin: 10px 5px;">Backup Data</button>
      </div>

      <div class="user-details">
        <h3>Current Data Storage</h3>
        <div class="detail-row">
          <span class="detail-label">Storage Type:</span>
          <span>Browser LocalStorage</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Data Encryption:</span>
          <span>None (Development Mode)</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Backup:</span>
          <span>Manual Export Only</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Data Persistence:</span>
          <span>Browser-specific</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Load and display users when page loads
    document.addEventListener('DOMContentLoaded', function() {
      loadUsers();
      updateStats();
    });

    function loadUsers() {
      const users = JSON.parse(localStorage.getItem('registeredUsers')) || [];
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const tableBody = document.getElementById('usersTableBody');
      
      if (users.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #666;">No users registered yet</td></tr>';
        return;
      }

      tableBody.innerHTML = users.map(user => {
        const isOnline = currentUser && currentUser.id === user.id && currentUser.isLoggedIn;
        const registrationDate = new Date(user.registrationDate).toLocaleDateString();
        const userInitial = user.firstName ? user.firstName.charAt(0).toUpperCase() : 'U';
        
        return `
          <tr>
            <td>
              <div class="user-info">
                <div class="user-avatar">${userInitial}</div>
                <div>
                  <strong>${user.firstName} ${user.lastName}</strong><br>
                  <small>ID: ${user.id}</small>
                </div>
              </div>
            </td>
            <td>${user.email}</td>
            <td>${user.phone || 'Not provided'}</td>
            <td>${registrationDate}</td>
            <td>
              <span class="status-badge ${isOnline ? 'status-online' : 'status-offline'}">
                ${isOnline ? 'Online' : 'Offline'}
              </span>
            </td>
            <td>
              <button class="action-btn btn-view" onclick="viewUser('${user.id}')">View</button>
              <button class="action-btn btn-delete" onclick="deleteUser('${user.id}')">Delete</button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function updateStats() {
      const users = JSON.parse(localStorage.getItem('registeredUsers')) || [];
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      
      // Update user stats
      document.getElementById('totalUsers').textContent = users.length;
      document.getElementById('onlineUsers').textContent = currentUser && currentUser.isLoggedIn ? 1 : 0;
      
      // Calculate new users today
      const today = new Date().toDateString();
      const newUsersToday = users.filter(user => {
        return new Date(user.registrationDate).toDateString() === today;
      }).length;
      document.getElementById('newUsersToday').textContent = newUsersToday;
      
      // Calculate total cart items
      const totalCartItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cartItems').textContent = totalCartItems;
      
      // Mock additional stats (in real app, these would come from order data)
      document.getElementById('totalOrders').textContent = Math.floor(users.length * 2.3); // Mock calculation
      document.getElementById('avgOrderValue').textContent = '‚Çπ' + (320 + Math.floor(Math.random() * 200));
      document.getElementById('conversionRate').textContent = (12 + Math.floor(Math.random() * 8)) + '%';
    }

    function filterUsers() {
      const searchTerm = document.getElementById('userSearch').value.toLowerCase();
      const rows = document.querySelectorAll('#usersTableBody tr');
      
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
      });
    }

    function viewUser(userId) {
      const users = JSON.parse(localStorage.getItem('registeredUsers')) || [];
      const user = users.find(u => u.id === userId);
      
      if (user) {
        const details = `
User Details:
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
ID: ${user.id}
Name: ${user.firstName} ${user.lastName}
Email: ${user.email}
Phone: ${user.phone || 'Not provided'}
Registered: ${new Date(user.registrationDate).toLocaleString()}
Password: ${user.password} (‚ö†Ô∏è Visible in development mode)
        `;
        alert(details);
      }
    }

    function deleteUser(userId) {
      if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
        let users = JSON.parse(localStorage.getItem('registeredUsers')) || [];
        users = users.filter(u => u.id !== userId);
        localStorage.setItem('registeredUsers', JSON.stringify(users));
        
        // If deleted user is currently logged in, log them out
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (currentUser && currentUser.id === userId) {
          localStorage.removeItem('currentUser');
        }
        
        loadUsers();
        updateStats();
        alert('User deleted successfully');
      }
    }

    function showSection(section) {
      // Hide all sections
      document.querySelectorAll('.admin-section').forEach(s => s.classList.add('hidden'));
      
      // Show selected section
      document.getElementById(section + 'Section').classList.remove('hidden');
      
      // Update active button
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
    }

    function refreshData() {
      loadUsers();
      updateStats();
      alert('Data refreshed successfully');
    }

    function exportData() {
      const users = JSON.parse(localStorage.getItem('registeredUsers')) || [];
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      const cart = JSON.parse(localStorage.getItem('cart')) || [];
      
      const exportData = {
        exportDate: new Date().toISOString(),
        totalUsers: users.length,
        users: users.map(user => ({
          ...user,
          password: '[HIDDEN]' // Don't export passwords
        })),
        currentSession: currentUser ? {
          ...currentUser,
          password: undefined
        } : null,
        cartData: cart
      };
      
      const dataStr = JSON.stringify(exportData, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = 'maa-anpurna-users-' + new Date().toISOString().split('T')[0] + '.json';
      link.click();
      
      URL.revokeObjectURL(url);
    }

    function clearAllData() {
      if (confirm('‚ö†Ô∏è WARNING: This will delete ALL user data including registrations and sessions. This cannot be undone. Are you sure?')) {
        if (confirm('This is your final confirmation. All data will be permanently deleted.')) {
          localStorage.removeItem('registeredUsers');
          localStorage.removeItem('currentUser');
          localStorage.removeItem('cart');
          localStorage.removeItem('userData');
          localStorage.removeItem('userPreferences');
          
          loadUsers();
          updateStats();
          alert('All data cleared successfully');
        }
      }
    }

    function createSampleData() {
      const sampleUsers = [
        {
          id: 'sample-' + Date.now(),
          firstName: 'Raj',
          lastName: 'Sharma',
          email: 'raj@example.com',
          phone: '+91 98765 43210',
          password: 'password123',
          registrationDate: new Date(Date.now() - 86400000).toISOString() // Yesterday
        },
        {
          id: 'sample-' + (Date.now() + 1),
          firstName: 'Priya',
          lastName: 'Patel',
          email: 'priya@example.com',
          phone: '+91 87654 32109',
          password: 'mypassword',
          registrationDate: new Date(Date.now() - 172800000).toISOString() // 2 days ago
        },
        {
          id: 'sample-' + (Date.now() + 2),
          firstName: 'Amit',
          lastName: 'Kumar',
          email: 'amit@example.com',
          phone: '+91 76543 21098',
          password: 'amit2025',
          registrationDate: new Date().toISOString() // Today
        }
      ];
      
      const existingUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
      const allUsers = [...existingUsers, ...sampleUsers];
      localStorage.setItem('registeredUsers', JSON.stringify(allUsers));
      
      loadUsers();
      updateStats();
      alert('Sample users created successfully');
    }

    function backupData() {
      exportData();
      alert('Backup exported successfully as JSON file');
    }
  </script>
</body>
</html>